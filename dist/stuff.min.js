(function(t){"use strict";function e(e,o,i){function r(){h.handshake(),l||(i(h),l=!0)}"function"==typeof o&&(i=o,o=null),i||(i=a),o||(o=document.querySelector("body"));var c=document.createElement("iframe"),h=new s(c);t.addEventListener("message",h.messageHandler.bind(h),!1),n.push(c),c.setAttribute("scrolling","no"),c.setAttribute("src",e);var l=!1;c.addEventListener("load",r,!1),o.appendChild(c)}function s(t){this.iframe=t,this.callbacks={},this.eventQ={load:[],evaljs:[],html:[]},this.secret=Math.ceil(999999999*Math.random())+1}var n=[],a=function(){};e.clear=function(){n.forEach(function(t){var e=t.parentElement;e&&e.removeChild(t)}),n=[]},s.prototype.handle=function(t,e){var s;if("custom"===t){var n=e;s=this.callbacks[n.type],s.forEach(function(t){"function"==typeof t&&t(n.data)})}else{if(s=this.eventQ[t],!s)return;var a=s.shift();"function"==typeof a&&a(e)}},s.prototype.messageHandler=function(t){var e;try{e=JSON.parse(t.data)}catch(s){return}if(e.secret===this.secret){var n=e.data,a=e.type;this.handle(a,n)}},s.prototype.post=function(t,e){this.iframe.contentWindow.postMessage(JSON.stringify({type:t,data:e,secret:this.secret}),"*")},s.prototype.evaljs=function(e,s){this.eventQ.evaljs.push(function(e){var n,o=e.error,i=o;o&&(n=t[o.__errorType__])&&(i=new n(o.message),i.stack=o.stack,i.type=o.type,i.arguments=o.arguments),(s||a)(i,e.result)}),this.post("evaljs",e)},s.prototype.load=function(t,e){this.eventQ.load.push(e),this.post("load",t)},s.prototype.html=function(t){this.eventQ.html.push(t),this.post("html",null)},s.prototype.handshake=function(){this.post("handshake",this.secret)},s.prototype.on=function(t,e){this.callbacks[t]?this.callbacks[t].push(e):this.callbacks[t]=[e]},s.prototype.off=function(t,e){var s=this.callbacks[t];if(s){var n=s.indexOf(e);-1!==n&&s.splice(n,1)}else this.callbacks[t]=[]},e.Context=s,t.stuff=e})(this);