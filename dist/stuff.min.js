(function(t){"use strict";function e(e,i,o){function r(){h.handshake(),l||(o(h),l=!0)}"function"==typeof i&&(o=i,i=null),o||(o=a),i||(i=document.querySelector("body"));var c=document.createElement("iframe"),h=new s(c);t.addEventListener("message",h.messageHandler.bind(h),!1),n.push(c),c.setAttribute("scrolling","no"),c.setAttribute("src",e);var l=!1;c.addEventListener("load",r,!1),i.appendChild(c)}function s(t){this.iframe=t,this.callbacks={},this.eventQ={load:[],evaljs:[],html:[]},this.secret=Math.ceil(999999999*Math.random())+1}var n=[],a=function(){};e.clear=function(){n.forEach(function(t){var e=t.parentElement;e&&e.removeChild(t)}),n=[]},s.prototype.handle=function(t,e){var s,n=this;if("custom"===t){var a=e;s=this.callbacks[a.type],s.forEach(function(t){"function"==typeof t&&t.call(t.thisArg||n,a.data)})}else{if(s=this.eventQ[t],!s)return;var i=s.shift();"function"==typeof i&&i.call(i.thisArg||n,e)}},s.prototype.messageHandler=function(t){var e;try{e=JSON.parse(t.data)}catch(s){return}if(e.secret===this.secret){var n=e.data,a=e.type;this.handle(a,n)}},s.prototype.post=function(t,e){this.iframe.contentWindow.postMessage(JSON.stringify({type:t,data:e,secret:this.secret}),"*")},s.prototype.evaljs=function(e,s,n){var i=function(e){var n,i=e.error,o=i;i&&(n=t[i.__errorType__])&&(o=new n(i.message),o.stack=i.stack,o.type=i.type,o.arguments=i.arguments),(s||a).call(this,o,e.result)};i.thisArg=n,this.eventQ.evaljs.push(i),this.post("evaljs",e)},s.prototype.load=function(t,e,s){e.thisArg=s,this.eventQ.load.push(e),this.post("load",t)},s.prototype.html=function(t,e){t.thisArg=e,this.eventQ.html.push(t),this.post("html",null)},s.prototype.handshake=function(){this.post("handshake",this.secret)},s.prototype.on=function(t,e,s){e.thisArg=s,this.callbacks[t]?this.callbacks[t].push(e):this.callbacks[t]=[e]},s.prototype.off=function(t,e){var s=this.callbacks[t];if(s){var n=s.indexOf(e);-1!==n&&s.splice(n,1)}else this.callbacks[t]=[]},e.Context=s,t.stuff=e})(this);